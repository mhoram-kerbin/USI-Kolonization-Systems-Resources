/*
Overview over USI Kolonization System Resources V0.20.4
Copyright 2014 By Mhoram

This Work may be distributed under the Creative Commons
Attribution-ShareAlike 4.0 International or Creative Commons
Attribution-NonCommercial-ShareAlike 4.0 International License as you
chose.

*/

# dot -Tpdf -o Resources.pdf Resources.dot
# dot -Tpng -o Resources.png Resources.dot

digraph Resources {
    compound=true;

    subgraph clusterLIFE {
        graph [label="Resource-Overview of USI Kolonization System V0.20.4 - Keeping Kerbals alive" fontsize=19];

        subgraph clusterDRILLS {
            label="Drilled Resources";
            LSubstrate [label="Substrate"];
            Water;
        }

        subgraph clusterProducts {
            label="Produced or delivered";
            PatchKitsL [label="PatchKits"];
            RepairKitsL [label="RepairKits"];
        }

        subgraph clusterCCC {
            label="Colony Control Center (*)";
            Command [label="Command\nPunchCards"];
        }

        subgraph clusterKerbal {
            label="Kerbal Products";
            Waste;
            WasteWater;
            CarbonDioxide;
        }

        subgraph clusterKerbalNeeds {
            label="Kerbal Needs";
            WaterN [label="Water"];
            Oxygen;
            Food;
        }

        subgraph clusterLIFESUPPORT {
            label="LifeSupport";
            color="orange";penwidth=2;
            subgraph  {
                color="black";penwidth=1;
                subgraph clusterKerbitat {
                    label="Kerbitat (8)";
                    Composter [label="Composter\nCompost"];
                    Habitat [label="Habitat\nFood"];
                    {
                        rank = same;
                        rankdir=LR;
                        edge [minlen=0];
                        Composter->Habitat [style=invisible,arrowhead=none];
                    }
                }

                subgraph clusterBIOLAB {
                    label="BioLab (6)";
                    BioMass;
                    Compost;
                }
            }

            subgraph clusterAeroponics {
                label="Aeroponics (7)";
                labeljust="r";
                color="black"; penwidth=1;
                "Air Filter" [label="Air Filter\nCarbonDioxide"];
                Greenhouse [label="Greenhouse\nBioMass,Oxygen"];
                Purify [label="Purify\nWater"];
            }

            edge [minlen=2, color="#666666"];
            Composter -> Greenhouse;
            Greenhouse -> Habitat [constraint = false];
            BioMass -> Habitat [constraint = false];
            Compost -> Greenhouse;

        }
#        CarbonDioxide -> Compost [lhead=clusterLIFESUPPORT; ltail=clusterKerbal];
        edge [minlen=3, color="#666666"];

        Waste -> Composter;
        WasteWater -> Purify;
        CarbonDioxide -> Greenhouse;

        PatchKitsL -> Habitat [lhead=clusterLIFESUPPORT];
        RepairKitsL -> BioMass [lhead=clusterLIFESUPPORT];

        "Air Filter" -> Oxygen [lhead=clusterKerbalNeeds; ltail=clusterLIFESUPPORT];
        Water -> WaterN;
        Water -> Compost [lhead=clusterLIFESUPPORT];
        LSubstrate -> Compost [lhead=clusterBIOLAB];

        Command -> Habitat [lhead=clusterLIFESUPPORT];

    }

    subgraph clusterPRODUCTION {
        graph [label="Resource-Overview of USI Kolonization System V0.20.4 - Creating Goods" fontsize=19];

        subgraph clusterCCCP {
            label="Colony Control Center (*)";
            CommandP [label="Command\nPunchCards"];
        }

        subgraph clusterProductionLine {
            label="Production Line";

            subgraph clusterBIOLABP {
                label="BioLab (6)";
                PBioMass [label="BioMass"];
            }

            subgraph clusterResources {
                label="Drilled Resources";
                SubstrateR [label="Substrate"];
                Ore;
                Minerals;
            }

            subgraph clusterRefinery {
                label="Refinery (9)";
                Metals;
                Polymers;
                Chemicals;
            }

            subgraph clusterFabrication {
                label="Fabrication (10)"
                ElectronicParts;
                PlasticParts;
                MechanicalParts;
            }

            subgraph clusterFactory {
                label="Factory (11)"
                ModularParts;
                Computers;
                Robotics;
            }

            subgraph clusterAssembly {
                label="Assembly (12)";
                "MEP-Computing";
                "MEP-Environmental";
                "MEP-Mining";
                "MEP-Laboratory";
                "MEP-Manufacturing";
                "MEP-Refining";
            }

            subgraph clusterSpecials {
                label="Expensive Materials\nfor Sale";
                ExoticMinerals;
                RareMetals;
            }
        }

        Recyclables [label="Recyclables\n(from nearly all Processes)"];

        subgraph clusterRepair {
            label="Repair Shop (4)";
            labeljust="r";
            PatchKits;
            RepairKits;
            ReplacementParts;
            Recycle [label="Recycle\nChemicals,Polymers,Metal"];
            edge [color="#666666"];
            {
                rank = same;
                edge [minlen=1];
                PatchKits -> RepairKits;
            }
            {
                Recycle -> PatchKits [style=invisible,arrowhead=none];
                RepairKits -> ReplacementParts [style=invisible,arrowhead=none];
            }
            PatchKits -> PatchKits [tailport=nw,headport=sw];
            RepairKits -> PatchKits;
            RepairKits -> RepairKits [tailport=ne,headport=se];
            ReplacementParts -> RepairKits [constraint = false];
            ReplacementParts -> ReplacementParts [tailport=nw,headport=sw];
        }

/*        {
            rank = same;
            ReplacementParts -> Chemicals;
        }
*/
        edge [minlen=3, color="#666666"];

        CommandP -> Minerals [lhead=clusterProductionLine];
        CommandP -> ReplacementParts [lhead=clusterRepair,constraint = false];
        ReplacementParts -> Ore [lhead=clusterProductionLine,ltail=clusterRepair];
        PBioMass -> Polymers [penwidth=2, color="orange"];
        SubstrateR -> PBioMass [tailport=sw,headport=w, penwidth=2, color="orange"];
        SubstrateR -> ReplacementParts [ltail=clusterProductionLine,lhead=clusterRepair];

        Polymers -> ExoticMinerals [ltail=clusterRefinery,lhead=clusterSpecials];
        Ore -> Chemicals [lhead=clusterRefinery; ltail=clusterResources, penwidth=2, color="orange"];

        Chemicals -> PlasticParts [lhead=clusterFabrication; ltail=clusterRefinery, penwidth=2, color="orange"];

        PlasticParts -> Computers [lhead=clusterFactory; ltail=clusterFabrication, penwidth=2, color="orange"];

        Computers -> "MEP-Mining" [lhead=clusterAssembly; ltail=clusterFactory, penwidth=2, color="orange"];

        Recyclables -> Recycle [tailport=sw,headport=nw];
    }




    subgraph clusterEXTENSION {
        graph [label="Resource-Overview of USI Kolonization System V0.20.4 - Extending the Base" fontsize=19];


        subgraph clusterCCCE {
            label="Colony Control Center (*)";
            CommandE [label="Command\nPunchCards\nNeeded for everything"];
        }

        subgraph clusterRepairE {
            label="Repair Shop (4)";
            RepairKitsE [label="PatchKits\nRepairKits\nReplacementParts"];
        }


        subgraph clusterRefineryE {
            label="Refinery (9)";
            PolymersE [label="Metals\nPolymers\nChemicals"];
        }

        subgraph clusterFabricationE {
            label="Fabrication (10)"
            PlasticPartsE [label="ElectronicParts\nPlasticParts\nMechanicalParts"];
        }

        subgraph clusterFactoryE {
            label="Factory (11)"
            ComputersE [label="Computers\nModularParts\nRobotics"];
        }

        subgraph clusterMachinery {
            label="Machinery Plant (3)";
            color="orange";penwidth=2;
            BasicMachinery;
            AdvMachinery;
            SpecMachinery;
            BasicMachinery -> AdvMachinery -> SpecMachinery;
        }


        RepairKitsE -> BasicMachinery [lhead=clusterMachinery; ltail=clusterRepairE];

        PolymersE -> BasicMachinery[ltail=clusterRefineryE,headport=w];
        PlasticPartsE -> AdvMachinery[ltail=clusterFabricationE];
        ComputersE -> SpecMachinery[ltail=clusterFactoryE];
    }

    # make the graphs appear below each other
    Food -> Recyclables [style=invisible,arrowhead=none, weight=0];
    "MEP-Computing" -> CommandE [style=invisible,arrowhead=none, weight=0];

}
